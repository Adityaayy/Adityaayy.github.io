<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RADAR — RC Configurator (Local)</title>

  <!-- Tailwind via CDN for quick styling (OK for local demo) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --accent: #8B5CF6; } /* faint purple */
    body { background: #fbfbff; }
    .option-card:hover { transform: translateY(-4px); box-shadow: 0 8px 22px rgba(139,92,246,0.06); }
    .disabled-card { opacity: 0.56; cursor: not-allowed; filter: grayscale(15%); }
    /* Make buttons a bit bigger for the premium feel */
    .big-btn { padding: .6rem 1rem; border-radius: .5rem; }
  </style>
</head>
<body class="min-h-screen font-sans text-gray-900">

  <div class="flex flex-col md:flex-row h-screen">
    <!-- LEFT: Big preview -->
    <main class="flex-1 flex flex-col items-center justify-start p-6">
      <div id="preview-wrap" class="w-full max-w-5xl" style="height:540px;">
        <div id="preview" class="w-full h-full rounded-lg overflow-hidden shadow-lg bg-white flex items-center justify-center">
          <img id="preview-img" src="" alt="preview" class="object-contain w-full h-full bg-white" />
        </div>
      </div>

      <div class="flex gap-3 mt-4">
        <button id="view-front" class="big-btn border text-sm" data-view="front">Front</button>
        <button id="view-side"  class="big-btn border text-sm" data-view="side">Side</button>
        <button id="view-top"   class="big-btn border text-sm" data-view="top">Top</button>
      </div>

      <div class="mt-4 text-sm text-gray-600 text-center max-w-3xl">
        <p>Main preview loads composite renders if available at <code class="bg-gray-100 p-1 rounded">renders/{motor}/{driver}/{battery}/{view}.png</code>.</p>
        <p class="mt-1">If you do not have renders yet, the preview uses a built-in placeholder. Add your Fusion exports into <code class="bg-gray-100 p-1 rounded">/renders/</code> to show real images.</p>
      </div>
    </main>

    <!-- RIGHT: Sidebar -->
    <aside class="w-full md:w-96 border-l p-5 overflow-auto" style="background:#faf8ff;">
      <h1 class="text-2xl font-bold mb-2">RADAR — RC Configurator</h1>

      <!-- Credits control -->
      <div class="p-3 rounded mb-4" style="border:1px solid rgba(139,92,246,0.10); background: linear-gradient(180deg, rgba(139,92,246,0.03), transparent);">
        <label class="block text-sm font-medium">Credits per team</label>
        <div class="flex gap-2 mt-2">
          <input id="credits-input" type="number" min="0" value="8" class="w-2/3 p-2 border rounded" />
          <button id="credits-reset" class="big-btn" style="background:var(--accent);color:white;">Reset</button>
        </div>
        <p class="mt-2 text-xs text-gray-600">Each option has a credit rating (1–3). Choose parts strategically. Default = 8 credits.</p>
      </div>

      <div id="options" class="space-y-5">
        <!-- Motor group -->
        <section>
          <div class="flex items-center justify-between mb-2">
            <label class="font-medium">Motor</label>
            <div class="text-xs text-gray-500">Credits</div>
          </div>
          <div id="motor-list" class="grid gap-2"></div>
        </section>

        <!-- Driver group -->
        <section>
          <div class="flex items-center justify-between mb-2">
            <label class="font-medium">Motor Driver</label>
            <div class="text-xs text-gray-500">Credits</div>
          </div>
          <div id="driver-list" class="grid gap-2"></div>
        </section>

        <!-- Battery group -->
        <section>
          <div class="flex items-center justify-between mb-2">
            <label class="font-medium">Battery</label>
            <div class="text-xs text-gray-500">Credits</div>
          </div>
          <div id="battery-list" class="grid gap-2"></div>
        </section>

        <!-- Wheels group -->
        <section>
          <div class="flex items-center justify-between mb-2">
            <label class="font-medium">Wheels</label>
            <div class="text-xs text-gray-500">Credits</div>
          </div>
          <div id="wheel-list" class="grid gap-2"></div>
        </section>
      </div>

      <!-- Summary -->
      <div class="mt-5 p-3 rounded" style="border:1px solid rgba(139,92,246,0.12); background:white;">
        <h2 class="font-semibold">Credits</h2>
        <p class="mt-2 text-sm">Build cost (credits): <strong id="credits-total">0</strong></p>
        <p class="mt-1 text-sm">Remaining credits: <strong id="credits-remaining" class="text-green-700">0</strong></p>
        <p class="mt-1 text-xs text-gray-500">Total for teams: <strong id="credits-teams">0</strong></p>

        <div class="mt-3 flex gap-2">
          <button id="suggest-build" class="px-3 py-2 rounded" style="background:var(--accent); color:white;">Suggest Build</button>
          <button id="copy-config" class="px-3 py-2 border rounded">Copy Config</button>
          <button id="export-json" class="px-3 py-2 border rounded">Export JSON</button>
        </div>

        <div id="exceed-note" class="mt-3 p-2 rounded bg-red-50 text-red-700 text-sm hidden">
          You have exceeded credits. Choose lower-credit options or increase credits per team.
        </div>
      </div>

      <div class="mt-4 text-xs text-gray-600">
        <strong>Tip:</strong> Higher-credit options mean better performance/durability. MX1508 is 2S-only — 3S battery is disabled when MX1508 is selected.
      </div>
    </aside>
  </div>

<script>
/*
  Local single-file configurator
  - No React
  - All assets local
  - Option arrays below (credit ratings 1-3, small notes, thumb filenames)
  - MX1508 driver -> disable 3S battery
  - Default credits per team = 8
  - Preview loads composite render from renders/{motor}/{driver}/{battery}/{view}.png
  - If image missing, fallback placeholder dataURI (simple SVG)
*/

/* -------------------------
   Helper: placeholder data URI (simple SVG)
   ------------------------- */
const placeholderSVG = (label='No image') => {
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='480'><rect width='100%' height='100%' fill='#111' opacity='0.12'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Arial,Helvetica,sans-serif' font-size='22' fill='#666'>${label}</text></svg>`;
  return 'data:image/svg+xml;base64,' + btoa(svg);
};

/* -------------------------
   DATA: options (no currency; only credits and notes)
   ------------------------- */

// Motors: 6 options - credits: 1,1,2,2,3,3
const motorOptions = [
  { id:'n20-60',  name:'N20 — 60 RPM (6V)',  credits:1, thumb:'images/motor-n20-60-thumb.png', note:'Low speed, low torque — precise and power-frugal.' },
  { id:'n20-120', name:'N20 — 120 RPM (6V)', credits:1, thumb:'images/motor-n20-120-thumb.png', note:'Slightly faster; still efficient.' },
  { id:'n20-300', name:'N20 — 300 RPM (6V)', credits:2, thumb:'images/motor-n20-300-thumb.png', note:'Balanced speed and current draw.' },
  { id:'n20-500', name:'N20 — 500 RPM (6V)', credits:2, thumb:'images/motor-n20-500-thumb.png', note:'Higher speed; higher current under load.' },
  { id:'12v-200', name:'12V Geared — 200 RPM', credits:3, thumb:'images/motor-12v-200-thumb.png', note:'High torque; needs higher-voltage supply.' },
  { id:'12v-400', name:'12V Geared — 400 RPM', credits:3, thumb:'images/motor-12v-400-thumb.png', note:'Powerful and fast. Ensure driver & battery compatibility.' }
];

// Drivers: L298N (1), MX1508 (2, 2S-only), TB6612 (3)
const driverOptions = [
  { id:'l298n', name:'L298N (basic)', credits:1, thumb:'images/driver-l298n-thumb.png', note:'Robust, but inefficient and hot under load.' },
  { id:'mx1508', name:'MX1508 (compact, 2S max)', credits:2, thumb:'images/driver-mx1508-thumb.png', note:'Good small-driver; rated for ~2S — 3S will stress it.' },
  { id:'tb6612', name:'TB6612FNG (efficient)', credits:3, thumb:'images/driver-tb6612-thumb.png', note:'Efficient dual H-bridge; lower heat, reliable.' }
];

// Batteries: 1S, 2S, 3S — credits 1,2,3
const batteryOptions = [
  { id:'1s-18650', name:'1S 18650 + TP4056', type:'1S', credits:1, thumb:'images/batt-1s-thumb.png', note:'Single cell; USB charging via TP4056. Not for 12V motors.' },
  { id:'2s-lipo',   name:'2S LiPo + BMS', type:'2S', credits:2, thumb:'images/batt-2s-thumb.png', note:'Good torque and moderate voltage. Use balance charger & BMS.' },
  { id:'3s-lipo',   name:'3S LiPo + BMS', type:'3S', credits:3, thumb:'images/batt-3s-thumb.png', note:'High voltage; use only with compatible drivers/motors.' }
];

// Wheels by motor family (n20 or 12v), credits and note
const wheelOptionsByMotor = {
  'n20': [
    { id:'wheel-n20-1', name:'Small Rubber 40mm', credits:1, image:'images/wheel-n20-1.png', note:'Good indoor grip; low inertia.' },
    { id:'wheel-n20-2', name:'Foam Tire 45mm', credits:2, image:'images/wheel-n20-2.png', note:'Better traction; slight speed cost.' },
    { id:'wheel-n20-3', name:'Slim Slick 40mm', credits:3, image:'images/wheel-n20-3.png', note:'Low rolling resistance; higher top speed.' }
  ],
  '12v': [
    { id:'wheel-12v-1', name:'Aggro Tread 60mm', credits:1, image:'images/wheel-12v-1.png', note:'Good for rough surfaces; higher inertia.' },
    { id:'wheel-12v-2', name:'Alloy Rim 58mm', credits:2, image:'images/wheel-12v-2.png', note:'Balanced performance and appearance.' },
    { id:'wheel-12v-3', name:'Offroad 65mm', credits:3, image:'images/wheel-12v-3.png', note:'High traction for uneven terrain.' }
  ]
};

/* -------------------------
   State (defaults)
   ------------------------- */
let state = {
  motor: motorOptions[0].id,
  driver: driverOptions[2].id, // TB6612 default (efficient)
  battery: batteryOptions[0].id,
  wheel: wheelOptionsByMotor['n20'][0].id,
  view: 'front',
  creditsPerTeam: 8,
  quantityTeams: 12
};

/* -------------------------
   Utility functions
   ------------------------- */
function motorFamily(motorId){
  if (!motorId) return 'n20';
  if (motorId.startsWith('n20')) return 'n20';
  if (motorId.startsWith('12v')) return '12v';
  return 'n20';
}

function findById(list, id){ return list.find(x => x.id === id); }

/* -------------------------
   DOM helper: create option card
   ------------------------- */
function createOptionCard({ id, name, credits, thumb, note, image }, groupKey, disabled ){
  const btn = document.createElement('button');
  btn.className = `option-card flex items-center gap-3 p-2 rounded-lg border bg-white text-left transition-transform`;
  if (disabled) {
    btn.classList.add('disabled-card');
    btn.disabled = true;
  }
  btn.dataset.value = id;

  const img = document.createElement('img');
  img.src = thumb || image || '';
  img.alt = name;
  img.style.width = '72px';
  img.style.height = '48px';
  img.style.objectFit = 'contain';
  img.onerror = () => { img.src = placeholderSVG(name); };

  const info = document.createElement('div');
  info.className = 'flex-1';
  info.innerHTML = `<div class="font-medium">${name}</div>
                    <div class="text-xs text-gray-500">Credits: ${credits}</div>
                    <div class="text-xs text-gray-500 mt-1">${note || ''}</div>`;

  btn.appendChild(img);
  btn.appendChild(info);

  btn.addEventListener('click', () => {
    if (disabled) return;
    // update state depending on group
    if (groupKey === 'motor') {
      state.motor = id;
      onMotorChanged();
    } else if (groupKey === 'driver') {
      state.driver = id;
      onDriverChanged();
    } else if (groupKey === 'battery') {
      state.battery = id;
      updateAll();
    } else if (groupKey === 'wheel') {
      state.wheel = id;
      updateAll();
    }
    highlightSelected();
  });

  return btn;
}

/* -------------------------
   Render option lists
   ------------------------- */
function renderMotorOptions(){
  const container = document.getElementById('motor-list');
  container.innerHTML = '';
  motorOptions.forEach(opt => {
    const card = createOptionCard(opt, 'motor', false);
    container.appendChild(card);
  });
}

function renderDriverOptions(){
  const container = document.getElementById('driver-list');
  container.innerHTML = '';
  driverOptions.forEach(opt => {
    const card = createOptionCard(opt, 'driver', false);
    container.appendChild(card);
  });
}

function renderBatteryOptions(){
  const container = document.getElementById('battery-list');
  container.innerHTML = '';
  batteryOptions.forEach(opt => {
    const disabled = (state.driver === 'mx1508' && opt.id === '3s-lipo'); // enforce compatibility rule
    const card = createOptionCard(opt, 'battery', disabled);
    container.appendChild(card);
  });
}

function renderWheelOptions(){
  const container = document.getElementById('wheel-list');
  container.innerHTML = '';
  const fam = motorFamily(state.motor);
  const list = wheelOptionsByMotor[fam] || [];
  list.forEach(opt => {
    const card = createOptionCard(opt, 'wheel', false);
    container.appendChild(card);
  });
}

/* -------------------------
   Update highlight of selected elements and summary
   ------------------------- */
function highlightSelected(){
  // motor
  document.querySelectorAll('#motor-list .option-card').forEach(btn => {
    btn.classList.toggle('border-[var(--accent)]', btn.dataset.value === state.motor);
    btn.classList.toggle('shadow-sm', btn.dataset.value === state.motor);
  });
  // driver
  document.querySelectorAll('#driver-list .option-card').forEach(btn => {
    btn.classList.toggle('border-[var(--accent)]', btn.dataset.value === state.driver);
    btn.classList.toggle('shadow-sm', btn.dataset.value === state.driver);
  });
  // battery
  document.querySelectorAll('#battery-list .option-card').forEach(btn => {
    btn.classList.toggle('border-[var(--accent)]', btn.dataset.value === state.battery);
    btn.classList.toggle('shadow-sm', btn.dataset.value === state.battery);
  });
  // wheels
  document.querySelectorAll('#wheel-list .option-card').forEach(btn => {
    btn.classList.toggle('border-[var(--accent)]', btn.dataset.value === state.wheel);
    btn.classList.toggle('shadow-sm', btn.dataset.value === state.wheel);
  });

  // update credits summary, remaining color
  updateCreditsSummary();
  updatePreview();
}

/* -------------------------
   Compute credits total and update summary display
   ------------------------- */
function updateCreditsSummary(){
  const mo = findById(motorOptions, state.motor);
  const dr = findById(driverOptions, state.driver);
  const ba = findById(batteryOptions, state.battery);
  const whList = wheelOptionsByMotor[motorFamily(state.motor)];
  const wh = whList.find(w=>w.id===state.wheel) || whList[0];

  const total = (mo?.credits||0) + (dr?.credits||0) + (ba?.credits||0) + (wh?.credits||0);
  const rem = state.creditsPerTeam - total;

  document.getElementById('credits-total').textContent = total;
  document.getElementById('credits-remaining').textContent = rem;
  document.getElementById('credits-teams').textContent = total * state.quantityTeams;

  const remElem = document.getElementById('credits-remaining');
  if (rem < 0) {
    remElem.classList.remove('text-green-700');
    remElem.classList.add('text-red-600');
    document.getElementById('exceed-note').classList.remove('hidden');
  } else {
    remElem.classList.remove('text-red-600');
    remElem.classList.add('text-green-700');
    document.getElementById('exceed-note').classList.add('hidden');
  }
}

/* -------------------------
   Preview update
   - composite path: renders/{motor}/{driver}/{battery}/{view}.png
   ------------------------- */
function updatePreview(){
  const view = state.view || 'front';
  // note: older versions used chassis in path; we removed chassis per latest requirement
  const path = `renders/${state.motor}/${state.driver}/${state.battery}/${view}.png`;
  const img = document.getElementById('preview-img');
  img.src = path;
  img.onerror = () => { img.src = placeholderSVG(`${state.motor} / ${state.driver} / ${state.battery} (${view})`); };
}

/* -------------------------
   Event handlers for changes
   ------------------------- */
function onMotorChanged(){
  // When motor changes, pick default wheel for family
  const fam = motorFamily(state.motor);
  const wList = wheelOptionsByMotor[fam] || [];
  if (wList.length) state.wheel = wList[0].id;
  // re-render wheel options
  renderWheelOptions();
  highlightSelected();
}

function onDriverChanged(){
  // Re-render battery options because MX1508 disables 3S
  renderBatteryOptions();
  highlightSelected();
}

/* -------------------------
   Suggest build: greedy cheapest-by-credits fit (respect MX1508 comp)
   ------------------------- */
function suggestBuild(){
  // sort by credits ascending
  const motorsSorted = [...motorOptions].sort((a,b)=>a.credits - b.credits);
  const driversSorted = [...driverOptions].sort((a,b)=>a.credits - b.credits);
  const battSorted = [...batteryOptions].sort((a,b)=>a.credits - b.credits);

  let picked = null;
  outer:
  for (const m of motorsSorted){
    const fam = motorFamily(m.id);
    const wheelList = wheelOptionsByMotor[fam] || [];
    for (const d of driversSorted){
      for (const b of battSorted){
        // skip incompatible combos
        if (d.id === 'mx1508' && b.id === '3s-lipo') continue;
        for (const w of wheelList){
          const creditsTotal = m.credits + d.credits + b.credits + w.credits;
          if (creditsTotal <= state.creditsPerTeam){
            picked = { m, d, b, w, creditsTotal };
            break outer;
          }
        }
      }
    }
  }

  if (picked){
    state.motor = picked.m.id;
    state.driver = picked.d.id;
    state.battery = picked.b.id;
    state.wheel = picked.w.id;
    renderWheelOptions();
    renderBatteryOptions();
    highlightSelected();
  } else {
    alert('No combination fits the current credits per team. Increase credits or relax requirements.');
  }
}

/* -------------------------
   Copy config to clipboard and export JSON
   ------------------------- */
function copyConfigToClipboard(){
  const payload = {
    motor: state.motor,
    driver: state.driver,
    battery: state.battery,
    wheel: state.wheel,
    creditsPerTeam: state.creditsPerTeam,
    quantityTeams: state.quantityTeams
  };
  navigator.clipboard.writeText(JSON.stringify(payload, null, 2)).then(()=> {
    alert('Config copied to clipboard');
  }).catch(()=> alert('Failed to copy config'));
}

function exportJSON(){
  const payload = {
    motor: state.motor,
    driver: state.driver,
    battery: state.battery,
    wheel: state.wheel,
    creditsPerTeam: state.creditsPerTeam,
    quantityTeams: state.quantityTeams,
    timestamp: new Date().toISOString()
  };
  const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'rc-config.json';
  a.click();
  URL.revokeObjectURL(url);
}

/* -------------------------
   Wire UI controls and init
   ------------------------- */
document.addEventListener('DOMContentLoaded', () => {
  // DOM nodes: view buttons
  document.getElementById('view-front').addEventListener('click', () => { state.view='front'; updatePreview(); });
  document.getElementById('view-side').addEventListener('click',  () => { state.view='side';  updatePreview(); });
  document.getElementById('view-top').addEventListener('click',   () => { state.view='top';   updatePreview(); });

  // credits input
  const creditsInput = document.getElementById('credits-input');
  creditsInput.addEventListener('change', e => {
    const v = parseInt(e.target.value || 0, 10);
    state.creditsPerTeam = v;
    updateCreditsSummary();
  });
  document.getElementById('credits-reset').addEventListener('click', () => {
    state.creditsPerTeam = 8;
    creditsInput.value = 8;
    updateCreditsSummary();
  });

  // suggest, copy, export
  document.getElementById('suggest-build').addEventListener('click', suggestBuild);
  document.getElementById('copy-config').addEventListener('click', copyConfigToClipboard);
  document.getElementById('export-json').addEventListener('click', exportJSON);

  // initialize lists
  renderMotorOptions();
  renderDriverOptions();
  renderBatteryOptions();
  renderWheelOptions();

  // quantity teams default
  // (we show total credits = total * quantityTeams — user can edit state.quantityTeams variable by changing code if desired)
  // If you want this editable in UI, drop an input; kept simple here per spec.

  // initial highlight and summary
  highlightSelected();
  updatePreview();
});
</script>

</body>
</html>
